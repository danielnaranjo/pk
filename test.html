<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.css">
</head>
<body>
	
	<ul>
		<li>Loading..</li>
	</ul>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<script src="https://drrjhlchpvi7e.cloudfront.net/libs/stamplay-js-sdk/2.0.5/stamplay.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.js"></script>

	<script>
		Stamplay.init("pooock");

		function getRandomInt(min, max) {
			return Math.floor(Math.random() * (max - min)) + min;
		}

		var tester = function(){
			var createData = {
				"icon":"ion-heart",
				"text":"Test " + new Date(),
				"title":"Test " + moment().unix(),
				"radius":20,
				"lon":getRandomInt(-99, 99)+'.'+getRandomInt(11111,999999),
				"lat":getRandomInt(-99, 99)+'.'+getRandomInt(11111,999999)
			};
			//console.debug('Executed on', new Date(), createData);
		}

		var createData = {
			"icon":"ion-heart",
			"text":"Test " + new Date(),
			"title":"Test " + moment().unix(),
			"radius":20,
			"lon":getRandomInt(-99, 99)+'.'+getRandomInt(11111,999999),
			"lat":getRandomInt(-99, 99)+'.'+getRandomInt(11111,999999)
		};
			/*
IDEA/PREMISA:

Almacenar todos los registros de hora/dia/semana/mes. SQLite o localStorage
Subir el block de registros al servidor, sea por usuario por item, cada X tiempo
Eliminar archivo de memoria, luego de Syncronizar
			*/

//https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/JSON/stringify#Example_of_using_JSON.stringify_with_localStorage

		var sync = function(data){
			
			console.info(localStorage);

			Stamplay.Object("notifications")
				.save(createData)
				.then(function(res) {
					$('ul').append('<li>'+ res.id+' @ '+ res.dt_create+' : '+ res.lat+','+res.lon+'</li>');
					//console.debug('Executed on', res.dt_create, res.id);
					localStorage.setItem(res.id, res.title);
				}, function(err) {
					toastr.error('Error', err.message);
					console.debug('Error', err.code);
				});

		}

		$(function(){
			$('ul').empty();
			//setInterval(tester, 30000); //ms
			setInterval(function(data){
				console.info(localStorage);
				Stamplay.Object("notifications")
					.save(createData)
					.then(function(res) {
						$('ul').append('<li>'+ res.id+' @ '+ res.dt_create+' : '+ res.lat+','+res.lon+'</li>');
						//console.debug('Executed on', res.dt_create, res.id);
						localStorage.setItem(res.id, res.title);
					}, function(err) {
						toastr.error('Error', err.message);
						console.debug('Error', err.code);
					});
			}, 30000); //ms
			//console.debug(localStorage.getItem('57be2fa8d276e9fd04d0e54f'));
		});

	</script>
	
</body>
</html>